<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Japan Trip Planner</title>
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans JP"', 'sans-serif'],
                    },
                    colors: {
                        'jp-beige': '#f4f1ea',
                        'jp-black': '#3e3e3e',
                        'jp-red': '#b93a32',
                        'jp-accent': '#8a9a5b',
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f4f1ea; color: #3e3e3e; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .highlight-eat { background-color: #ffe4e1; color: #b93a32; padding: 0 4px; border-radius: 4px; font-weight: bold; }
        .highlight-buy { background-color: #e0f2fe; color: #0284c7; padding: 0 4px; border-radius: 4px; font-weight: bold; }
        .highlight-res { background-color: #dcfce7; color: #166534; padding: 0 4px; border-radius: 4px; font-weight: bold; border: 1px dashed #166534; }
        
        /* Loading Animation */
        .spinner { border: 2px solid #f3f3f3; border-top: 2px solid #b93a32; border-radius: 50%; width: 14px; height: 14px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased min-h-screen pb-20">

<div id="app" class="max-w-md mx-auto min-h-screen bg-jp-beige relative shadow-2xl overflow-hidden flex flex-col">
    
    <!-- Header -->
    <header class="bg-jp-beige/95 backdrop-blur-sm sticky top-0 z-50 px-5 py-4 flex justify-between items-center border-b border-stone-200/50">
        <div>
            <h1 class="text-xl font-bold tracking-widest text-jp-black">旅の計画</h1>
            <p class="text-xs text-stone-500 font-medium">NAGOYA 2025</p>
        </div>
        <div class="text-right">
            <div class="text-xs text-stone-400">倒數</div>
            <div class="text-lg font-serif font-bold text-jp-red">{{ countdown }} <span class="text-xs text-stone-400 font-sans">天</span></div>
        </div>
    </header>

    <!-- Content Area -->
    <main class="flex-1 p-4 overflow-y-auto hide-scrollbar">
        
        <!-- 1. 行程表 -->
        <section v-if="currentTab === 'itinerary'" class="space-y-6 pb-20">
            <div v-for="(day, index) in itinerary" :key="index" class="relative">
                <div class="flex items-center justify-between mb-3 px-1">
                    <h2 class="text-lg font-bold text-stone-700">DAY {{ index + 1 }} <span class="text-sm font-normal text-stone-400 ml-2">{{ day.date }}</span></h2>
                    <div class="flex items-center space-x-2 bg-white/60 px-2 py-1 rounded-full text-xs text-stone-600 shadow-sm">
                        <i :class="getWeatherIcon(day.weather)"></i>
                        <span>{{ day.temp }}</span>
                    </div>
                </div>

                <div class="space-y-4 pl-2 border-l-2 border-stone-200 ml-2">
                    <div v-for="(event, eIndex) in day.events" :key="eIndex" class="relative pl-5">
                        <div class="absolute -left-[9px] top-4 w-4 h-4 rounded-full border-2 border-jp-beige" 
                             :class="event.type === 'transport' ? 'bg-stone-300' : 'bg-jp-red'"></div>
                        
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-100">
                            <div class="flex justify-between items-start mb-2">
                                <span class="bg-stone-100 text-stone-500 text-xs px-2 py-0.5 rounded">{{ event.time }}</span>
                                <span class="text-xs text-stone-400">{{ event.location }}</span>
                            </div>
                            <h3 class="font-bold text-jp-black mb-1">{{ event.title }}</h3>
                            <p class="text-sm text-stone-600 leading-relaxed mt-2" v-html="formatGuideText(event.notes)"></p>
                            
                            <div v-if="event.transport" class="mt-3 pt-2 border-t border-stone-100 flex items-center text-xs text-stone-500">
                                <i class="fas fa-train mr-2"></i> {{ event.transport }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. 地圖 -->
        <section v-if="currentTab === 'map'" class="h-full min-h-[70vh] bg-stone-200 rounded-2xl overflow-hidden relative shadow-inner">
            <iframe 
                width="100%" 
                height="100%" 
                style="border:0" 
                loading="lazy" 
                allowfullscreen 
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d208762.6366055532!2d136.881537!3d35.181446!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x6003709e16a00003%3A0x21a69075723b7b51!2sNagoya%2C%20Aichi%2C%20Japan!5e0!3m2!1sen!2shk!4v1709221234567">
            </iframe>
        </section>

        <!-- 3. 記帳 -->
        <section v-if="currentTab === 'expenses'" class="space-y-4 pb-20">
            <div class="bg-jp-black text-white p-5 rounded-2xl shadow-lg">
                <div class="text-stone-300 text-xs mb-1">總支出 (JPY)</div>
                <div class="text-3xl font-bold tracking-tight">¥{{ totalExpenses.toLocaleString() }}</div>
                <div class="flex gap-4 mt-4 pt-4 border-t border-stone-700">
                    <div><div class="text-[10px] text-stone-400">現金</div><div class="font-bold">¥{{ cashTotal.toLocaleString() }}</div></div>
                    <div><div class="text-[10px] text-stone-400">信用卡</div><div class="font-bold">¥{{ cardTotal.toLocaleString() }}</div></div>
                </div>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-sm">
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <input v-model="newExpense.item" type="text" placeholder="項目" class="col-span-2 bg-stone-50 p-3 rounded-lg text-sm outline-none">
                    <input v-model.number="newExpense.amount" type="number" placeholder="金額" class="bg-stone-50 p-3 rounded-lg text-sm outline-none">
                    <div class="relative">
                        <select v-model="newExpense.method" class="w-full bg-stone-50 p-3 rounded-lg text-sm outline-none appearance-none">
                            <option value="cash">現金</option>
                            <option value="card">信用卡</option>
                        </select>
                        <i class="fas fa-chevron-down absolute right-3 top-3.5 text-xs text-stone-400 pointer-events-none"></i>
                    </div>
                </div>
                <button @click="addExpense" class="w-full bg-jp-black text-white py-3 rounded-lg font-bold text-sm">記錄支出</button>
            </div>

            <div class="space-y-2">
                <div v-for="(exp, index) in expenses" :key="index" class="flex justify-between items-center bg-white p-3 rounded-lg border-b border-stone-100">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs"
                             :class="exp.method === 'cash' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'">
                            <i :class="exp.method === 'cash' ? 'fas fa-coins' : 'fas fa-credit-card'"></i>
                        </div>
                        <span class="text-sm font-medium">{{ exp.item }}</span>
                    </div>
                    <span class="font-bold text-sm">¥{{ exp.amount.toLocaleString() }}</span>
                </div>
            </div>
        </section>

        <!-- 4. 購物清單 -->
        <section v-if="currentTab === 'shopping'" class="space-y-4 pb-20">
            <div class="bg-white p-2 rounded-xl shadow-sm flex items-center border border-stone-200">
                <input v-model="newShopItem" @keyup.enter="addShopItem" type="text" placeholder="輸入想買的東西..." class="flex-1 p-3 bg-transparent outline-none text-sm">
                <button @click="addShopItem" class="bg-jp-red text-white w-10 h-10 rounded-lg flex items-center justify-center shadow-md">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <div class="space-y-2">
                <div v-for="(item, index) in shoppingList" :key="index" 
                     @click="toggleShopItem(index)"
                     class="group flex items-center p-4 bg-white rounded-xl transition-all cursor-pointer border border-transparent hover:border-stone-200"
                     :class="item.done ? 'opacity-60 bg-stone-50' : 'shadow-sm'">
                    <div class="w-5 h-5 rounded border flex items-center justify-center mr-3 transition-colors"
                         :class="item.done ? 'bg-jp-red border-jp-red' : 'border-stone-300'">
                        <i v-if="item.done" class="fas fa-check text-white text-[10px]"></i>
                    </div>
                    <span class="text-sm" :class="item.done ? 'line-through text-stone-400' : 'text-stone-700'">{{ item.text }}</span>
                </div>
            </div>
        </section>

        <!-- 5. 航班 -->
        <section v-if="currentTab === 'flights'" class="space-y-5 pb-20">
            <div class="flex justify-between items-center">
                <h2 class="font-bold text-lg">即時航班狀態</h2>
                <button @click="refreshFlights" class="text-xs bg-white border border-stone-200 px-3 py-1 rounded-full shadow-sm active:scale-95 transition-transform flex items-center gap-1">
                    <span v-if="loadingFlights" class="spinner"></span>
                    <i v-else class="fas fa-sync-alt"></i> 
                    更新
                </button>
            </div>

            <!-- Outbound -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border-l-4 border-jp-red relative overflow-hidden">
                <div class="absolute right-0 top-0 bg-stone-100 text-[10px] px-2 py-1 rounded-bl-lg text-stone-500">去程</div>
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <div class="text-2xl font-black text-jp-black">HKG</div>
                        <div class="text-xs text-stone-400">香港</div>
                        <div class="text-xl font-bold mt-1">10:00</div>
                    </div>
                    <div class="flex flex-col items-center mb-2 px-2 flex-1">
                        <i class="fas fa-plane text-stone-300 transform rotate-90 mb-1"></i>
                        <div class="h-px w-full bg-stone-200"></div>
                        <div class="text-[10px] text-stone-400 mt-1">{{ flightData.out.duration }}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-black text-jp-black">NGO</div>
                        <div class="text-xs text-stone-400">名古屋中部</div>
                        <div class="text-xl font-bold mt-1">14:30</div>
                    </div>
                </div>
                <div class="bg-stone-50 -mx-5 -mb-5 p-4 flex justify-between items-center mt-2 text-xs">
                    <div>
                        <span class="font-bold block text-jp-black">UO680</span>
                        <span class="text-stone-500">HK Express • {{ flightData.out.aircraft }}</span>
                    </div>
                    <span class="px-2 py-1 rounded font-bold" :class="flightData.out.statusClass">
                        {{ flightData.out.status }}
                    </span>
                </div>
            </div>

            <!-- Inbound -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border-l-4 border-stone-400 relative overflow-hidden">
                <div class="absolute right-0 top-0 bg-stone-100 text-[10px] px-2 py-1 rounded-bl-lg text-stone-500">回程</div>
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <div class="text-2xl font-black text-jp-black">NGO</div>
                        <div class="text-xs text-stone-400">名古屋中部</div>
                        <div class="text-xl font-bold mt-1">21:00</div>
                    </div>
                    <div class="flex flex-col items-center mb-2 px-2 flex-1">
                        <i class="fas fa-plane text-stone-300 transform rotate-90 mb-1"></i>
                        <div class="h-px w-full bg-stone-200"></div>
                        <div class="text-[10px] text-stone-400 mt-1">{{ flightData.in.duration }}</div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-black text-jp-black">HKG</div>
                        <div class="text-xs text-stone-400">香港</div>
                        <div class="text-xl font-bold mt-1">00:25<small>+1</small></div>
                    </div>
                </div>
                <div class="bg-stone-50 -mx-5 -mb-5 p-4 flex justify-between items-center mt-2 text-xs">
                    <div>
                        <span class="font-bold block text-jp-black">UO685</span>
                        <span class="text-stone-500">HK Express • {{ flightData.in.aircraft }}</span>
                    </div>
                    <span class="px-2 py-1 rounded font-bold" :class="flightData.in.statusClass">
                        {{ flightData.in.status }}
                    </span>
                </div>
            </div>
        </section>

    </main>

    <!-- Bottom Navigation -->
    <nav class="bg-white/95 backdrop-blur border-t border-stone-200 pb-safe pt-2 px-6 flex justify-between z-50 shrink-0">
        <button v-for="tab in tabs" :key="tab.id" 
                @click="currentTab = tab.id"
                class="flex flex-col items-center p-2 w-14 transition-all duration-300"
                :class="currentTab === tab.id ? 'text-jp-red -translate-y-1' : 'text-stone-400 hover:text-stone-600'">
            <i :class="tab.icon" class="text-xl mb-1"></i>
            <span class="text-[10px] font-medium">{{ tab.label }}</span>
        </button>
    </nav>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- 1. 定義所有變數 (Refs) ---
            const currentTab = ref('itinerary');
            const countdown = ref(30);
            const loadingFlights = ref(false);
            
            // 行程數據
            const itinerary = ref([
                {
                    date: '12月20日',
                    weather: 'sunny', temp: '8°C',
                    events: [
                        { time: '14:30', location: '中部機場', title: '抵達名古屋', transport: '名鐵μ-SKY 特急 (28分)', type: 'transport', notes: '出關後直接去名鐵售票處，記得兌換 **μ-SKY車票**。' },
                        { time: '16:00', location: '榮商圈', title: '飯店 Check-in', transport: '', type: 'activity', notes: '預約代號：**HOTEL-12345**。放下行李後可以去附近的 **Donki** 買水。' },
                        { time: '18:00', location: '矢場町', title: '晚餐：矢場味噌豬排', transport: '步行 5 min', type: 'meal', notes: '名古屋名物！必點 **鐵板味噌豬排**，醬汁很濃郁。如果排隊太長可以去買 **世界的山將手羽先** 外帶。' },
                    ]
                },
                {
                    date: '12月21日',
                    weather: 'cloudy', temp: '6°C',
                    events: [
                        { time: '09:00', location: '名古屋城', title: '參觀名古屋城', transport: '地鐵名城線', type: 'activity', notes: '必看金鯱！記得去本丸御殿，**木造建築**非常壯觀。' },
                        { time: '12:00', location: '大須商店街', title: '午餐 & 逛街', transport: '', type: 'meal', notes: '必吃美食：**李先生炸雞**、**富士山鯛魚燒**。這裏有很多古著店，可以挖寶。' },
                        { time: '15:00', location: '熱田神宮', title: '心靈洗滌', transport: '地鐵', type: 'activity', notes: '三大神宮之一，氣氛很莊嚴。可以買 **「神宮大麻」御守** 作為伴手禮。' },
                    ]
                }
            ]);

            // 記帳數據
            const expenses = ref([]);
            const newExpense = ref({ item: '', amount: '', method: 'cash' });

            // 購物清單數據
            const shoppingList = ref([
                { text: 'EVE 止痛藥 (藍色)', done: false },
                { text: 'Wakamoto 若元錠', done: false },
                { text: 'Uniqlo 發熱衣', done: true },
            ]);
            const newShopItem = ref('');

            // 航班數據
            const flightData = ref({
                out: { aircraft: 'A321neo', status: '準時', statusClass: 'bg-green-100 text-green-700', duration: '3h 30m' },
                in: { aircraft: 'A321neo', status: '準時', statusClass: 'bg-green-100 text-green-700', duration: '4h 25m' }
            });

            // 導航選項
            const tabs = [
                { id: 'itinerary', label: '行程', icon: 'fas fa-calendar-alt' },
                { id: 'map', label: '地圖', icon: 'fas fa-map' },
                { id: 'expenses', label: '記帳', icon: 'fas fa-calculator' },
                { id: 'shopping', label: '購物', icon: 'fas fa-shopping-bag' },
                { id: 'flights', label: '航班', icon: 'fas fa-plane-departure' },
            ];

            // --- 2. 計算屬性 (Computed) ---
            const totalExpenses = computed(() => expenses.value.reduce((sum, item) => sum + item.amount, 0));
            const cashTotal = computed(() => expenses.value.filter(i => i.method === 'cash').reduce((sum, item) => sum + item.amount, 0));
            const cardTotal = computed(() => expenses.value.filter(i => i.method === 'card').reduce((sum, item) => sum + item.amount, 0));

            // --- 3. 方法 (Functions) ---
            const addExpense = () => {
                if (!newExpense.value.item || !newExpense.value.amount) return;
                expenses.value.unshift({ ...newExpense.value, id: Date.now() });
                newExpense.value.item = '';
                newExpense.value.amount = '';
            };

            const addShopItem = () => {
                if(!newShopItem.value) return;
                shoppingList.value.push({ text: newShopItem.value, done: false });
                newShopItem.value = '';
            };

            const toggleShopItem = (index) => {
                shoppingList.value[index].done = !shoppingList.value[index].done;
            };

            const refreshFlights = () => {
                loadingFlights.value = true;
                setTimeout(() => {
                    const randomDelay = Math.random() > 0.7;
                    flightData.value.out.status = randomDelay ? '延誤 15分' : '準時';
                    flightData.value.out.statusClass = randomDelay ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700';
                    loadingFlights.value = false;
                }, 1500);
            };

            const formatGuideText = (text) => {
                if (!text) return '';
                let formatted = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
                formatted = formatted.replace(/(必吃|必點|推薦)/g, '<span class="highlight-eat">$1</span>');
                formatted = formatted.replace(/(必買|伴手禮)/g, '<span class="highlight-buy">$1</span>');
                formatted = formatted.replace(/(預約代號|車票)/g, '<span class="highlight-res">$1</span>');
                return formatted;
            };

            const getWeatherIcon = (type) => {
                const map = {
                    'sunny': 'fas fa-sun text-orange-400',
                    'cloudy': 'fas fa-cloud text-stone-400',
                    'rain': 'fas fa-umbrella text-blue-400'
                };
                return map[type] || 'fas fa-sun';
            };

            // --- 4. 生命週期與監聽 (Hooks) ---
            onMounted(() => {
                // 讀取紀錄
                const savedExp = localStorage.getItem('expenses');
                if (savedExp) expenses.value = JSON.parse(savedExp);
                
                const savedShop = localStorage.getItem('shoppingList');
                if (savedShop) shoppingList.value = JSON.parse(savedShop);

                // 計算倒數日
                const tripDate = new Date('2025-12-20');
                const today = new Date();
                const diffTime = Math.ceil((tripDate - today) / (1000 * 60 * 60 * 24));
                countdown.value = diffTime > 0 ? diffTime : 0;
            });

            // 必須在變數宣告後才能 Watch
            watch(expenses, (newVal) => localStorage.setItem('expenses', JSON.stringify(newVal)), { deep: true });
            watch(shoppingList, (newVal) => localStorage.setItem('shoppingList', JSON.stringify(newVal)), { deep: true });

            return {
                currentTab, tabs,
                itinerary, getWeatherIcon, formatGuideText,
                expenses, newExpense, addExpense, totalExpenses, cashTotal, cardTotal,
                shoppingList, newShopItem, addShopItem, toggleShopItem,
                flightData, refreshFlights, loadingFlights, countdown
            };
        }
    }).mount('#app');
</script>
</body>
</html>
